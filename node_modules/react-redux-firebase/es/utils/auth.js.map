{"version":3,"sources":["../../src/utils/auth.js"],"names":["createAuthProvider","firebase","providerName","scopes","capitalProviderName","auth","Error","provider","customAuthParameters","_","config","setCustomParameters","toLowerCase","addScope","forEach","scope","getLoginMethodAndParams","creds","email","password","type","token","phoneNumber","applicationVerifier","credential","credentialAuth","signInAndRetrieveDataWithCredential","method","params","indexOf","authProvider","tokenAuth","signInAndRetrieveDataWithCustomToken","signInWithEmailAndPassword","isAuthReady","store","stateName","state","getState","firebaseState","firebaseAuthState","isLoaded","authIsReady","Promise","resolve","unsubscribe","subscribe","createAuthIsReady","firebaseStateName","updateProfileOnRTDB","profileUpdate","database","authUid","profileRef","ref","userProfile","update","then","once","updateProfileOnFirestore","options","useSet","merge","firestore","doc","profileUpdatePromise","set","get","setupPresence","dispatch","ServerValue","presence","sessions","amOnline","child","onlineRef","currentUser","sessionsRef","on","snapShot","val","actionTypes","SESSION_START","payload","session","push","startedAt","TIMESTAMP","user","setPriority","onDisconnect","SESSION_END","remove"],"mappings":"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","sourcesContent":["import { capitalize, isArray, isString, isFunction } from 'lodash'\nimport { supportedAuthProviders, actionTypes } from '../constants'\n\n/**\n * @description Get correct login method and params order based on provided credentials\n * @param {Object} firebase - Internal firebase object\n * @param {String} providerName - Name of Auth Provider (i.e. google, github, facebook, twitter)\n * @param {Array|String} scopes - List of scopes to add to auth provider\n * @return {firebase.auth.AuthCredential} provider - Auth Provider\n * @private\n */\nfunction createAuthProvider(firebase, providerName, scopes) {\n  // TODO: Verify scopes are valid before adding\n  // TODO: Validate parameter inputs\n  const capitalProviderName = `${capitalize(providerName)}AuthProvider`\n\n  // Throw if auth provider does not exist on Firebase instance\n  if (!firebase.auth[capitalProviderName]) {\n    throw new Error(\n      `${providerName} is not a valid auth provider for your firebase instance. If using react-native, use a RN specific auth library.`\n    )\n  }\n\n  const provider = new firebase.auth[capitalProviderName]()\n\n  // Custom Auth Parameters\n  // TODO: Validate parameter inputs\n  const { customAuthParameters } = firebase._.config\n  if (customAuthParameters && customAuthParameters[providerName]) {\n    provider.setCustomParameters(customAuthParameters[providerName])\n  }\n\n  // Handle providers without scopes\n  if (\n    providerName.toLowerCase() === 'twitter' ||\n    !isFunction(provider.addScope)\n  ) {\n    return provider\n  }\n\n  // TODO: Verify scopes are valid before adding\n  provider.addScope('email')\n\n  if (scopes) {\n    if (isArray(scopes)) {\n      scopes.forEach(scope => {\n        provider.addScope(scope)\n      })\n    }\n    if (isString(scopes)) {\n      provider.addScope(scopes)\n    }\n  }\n\n  return provider\n}\n\n/**\n * @description Get correct login method and params order based on provided\n * credentials\n * @param {Object} firebase - Internal firebase object\n * @param {Object} credentials - Login credentials\n * @param {String} credentials.email - Email to login with (only needed for\n * email login)\n * @param {String} credentials.password - Password to login with (only needed\n * for email login)\n * @param {String} credentials.provider - Provider name such as google, twitter\n * (only needed for 3rd party provider login)\n * @param {String} credentials.type - Popup or redirect (only needed for 3rd\n * party provider login)\n * @param {String} credentials.token - Custom or provider token\n * @param {firebase.auth.AuthCredential} credentials.credential - Custom or\n * provider token\n * @param {Array|String} credentials.scopes - Scopes to add to provider\n * (i.e. email)\n * @private\n */\nexport function getLoginMethodAndParams(firebase, creds) {\n  const {\n    email,\n    password,\n    provider,\n    type,\n    token,\n    scopes,\n    phoneNumber,\n    applicationVerifier,\n    credential\n  } = creds\n  // Credential Auth\n  if (credential) {\n    // Attempt to use signInAndRetrieveDataWithCredential if it exists (see #467 for more info)\n    const credentialAuth = firebase.auth().signInAndRetrieveDataWithCredential\n\n    if (credentialAuth) {\n      return {\n        method: 'signInAndRetrieveDataWithCredential',\n        params: [credential]\n      }\n    }\n    return { method: 'signInWithCredential', params: [credential] }\n  }\n\n  // Provider Auth\n  if (provider) {\n    // Verify providerName is valid\n    if (supportedAuthProviders.indexOf(provider.toLowerCase()) === -1) {\n      throw new Error(`${provider} is not a valid Auth Provider`)\n    }\n    if (token) {\n      throw new Error(\n        'provider with token no longer supported, use credential parameter instead'\n      )\n    }\n    const authProvider = createAuthProvider(firebase, provider, scopes)\n    if (type === 'popup') {\n      return { method: 'signInWithPopup', params: [authProvider] }\n    }\n    return { method: 'signInWithRedirect', params: [authProvider] }\n  }\n\n  // Token Auth\n  if (token) {\n    // Check for new sign in method (see #484 for more info)\n    const tokenAuth = firebase.auth().signInAndRetrieveDataWithCustomToken\n\n    if (tokenAuth) {\n      return { method: 'signInAndRetrieveDataWithCustomToken', params: [token] }\n    }\n\n    return { method: 'signInWithCustomToken', params: [token] }\n  }\n\n  // Phone Number Auth\n  if (phoneNumber) {\n    if (!applicationVerifier) {\n      throw new Error(\n        'Application verifier is required for phone authentication'\n      )\n    }\n    return {\n      method: 'signInWithPhoneNumber',\n      params: [phoneNumber, applicationVerifier]\n    }\n  }\n\n  // Check for new sign in method (see #484 for more info)\n  // Note: usage of signInAndRetrieveDataWithEmailAndPassword is now a fallback since it is deprecated (see #484 for more info)\n  if (!firebase.auth().signInWithEmailAndPassword) {\n    return {\n      method: 'signInAndRetrieveDataWithEmailAndPassword',\n      params: [email, password]\n    }\n  }\n\n  // Email/Password Auth\n  return { method: 'signInWithEmailAndPassword', params: [email, password] }\n}\n\n/**\n * Returns a promise that completes when Firebase Auth is ready in the given\n * store using react-redux-firebase.\n * @param {Object} store - The Redux store on which we want to detect if\n * Firebase auth is ready.\n * @param {string} [stateName='firebase'] - The attribute name of the\n * react-redux-firebase reducer when using multiple combined reducers.\n * 'firebase' by default. Set this to `null` to indicate that the\n * react-redux-firebase reducer is not in a combined reducer.\n * @return {Promise} Resolves when Firebase auth is ready in the store.\n */\nfunction isAuthReady(store, stateName) {\n  const state = store.getState()\n  const firebaseState = stateName ? state[stateName] : state\n  const firebaseAuthState = firebaseState && firebaseState.auth\n  if (!firebaseAuthState) {\n    throw new Error(\n      `The Firebase auth state could not be found in the store under the attribute '${\n        stateName ? `${stateName}.` : ''\n      }auth'. Make sure your react-redux-firebase reducer is correctly set in the store`\n    )\n  }\n  return firebaseState.auth.isLoaded\n}\n\n/**\n * Returns a promise that completes when Firebase Auth is ready in the given\n * store using react-redux-firebase.\n * @param {Object} store - The Redux store on which we want to detect if\n * Firebase auth is ready.\n * @param {string} [stateName='firebase'] - The attribute name of the react-redux-firebase\n * reducer when using multiple combined reducers. 'firebase' by default. Set\n * this to `null` to indicate that the react-redux-firebase reducer is not in a\n * combined reducer.\n * @return {Promise} Resolve when Firebase auth is ready in the store.\n */\nexport function authIsReady(store, stateName = 'firebase') {\n  return new Promise(resolve => {\n    if (isAuthReady(store, stateName)) {\n      resolve()\n    } else {\n      const unsubscribe = store.subscribe(() => {\n        if (isAuthReady(store, stateName)) {\n          unsubscribe()\n          resolve()\n        }\n      })\n    }\n  })\n}\n\n/**\n * Function that creates and authIsReady promise\n * @param {Object} store - The Redux store on which we want to detect if\n * Firebase auth is ready.\n * @param {Object} config - Config options for authIsReady\n * @param {string} config.authIsReady - Config options for authIsReady\n * @param {string} config.firebaseStateName - Config options for authIsReady\n * @return {Promise} Resolves when Firebase auth is ready in the store.\n */\nexport function createAuthIsReady(store, config) {\n  return isFunction(config.authIsReady)\n    ? config.authIsReady(store, config)\n    : authIsReady(store, config.firebaseStateName)\n}\n\n/**\n * Update profile data on Firebase Real Time Database\n * @param  {Object} firebase - internal firebase object\n * @param  {Object} profileUpdate - Updates to profile object\n * @return {Promise} Resolves with results of profile get\n */\nexport function updateProfileOnRTDB(firebase, profileUpdate) {\n  const { database, _: { config, authUid } } = firebase\n  const profileRef = database().ref(`${config.userProfile}/${authUid}`)\n  return profileRef.update(profileUpdate).then(() => profileRef.once('value'))\n}\n\n/**\n * Update profile data on Firestore by calling set (with merge: true) on\n * the profile.\n * @param  {Object} firebase - internal firebase object\n * @param  {Object} profileUpdate - Updates to profile object\n * @param  {Object} options - Options object for configuring how profile\n * update occurs\n * @param  {Boolean} [options.useSet=true] - Use set with merge instead of\n * update. Setting to `false` uses update (can cause issue of profile document\n * does not exist).\n * @param  {Boolean} [options.merge=true] - Whether or not to use merge when\n * setting profile\n * @return {Promise} Resolves with results of profile get\n */\nexport function updateProfileOnFirestore(\n  firebase,\n  profileUpdate,\n  options = {}\n) {\n  const { useSet = true, merge = true } = options\n  const { firestore, _: { config, authUid } } = firebase\n  const profileRef = firestore().doc(`${config.userProfile}/${authUid}`)\n  // Use set with merge (to prevent \"No document to update\") unless otherwise\n  // specificed through options\n  const profileUpdatePromise = useSet\n    ? profileRef.set(profileUpdate, { merge })\n    : profileRef.update(profileUpdate)\n  return profileUpdatePromise.then(() => profileRef.get())\n}\n\n/**\n * @description Start presence management for a specificed user uid.\n * Presence collection contains a list of users that are online currently.\n * Sessions collection contains a record of all user sessions.\n * This function is called within login functions if enablePresence: true.\n * @param {Function} dispatch - Action dispatch function\n * @param {Object} firebase - Internal firebase object\n * @return {Promise}\n * @private\n */\nexport function setupPresence(dispatch, firebase) {\n  // exit if database does not exist on firebase instance\n  if (!firebase.database || !firebase.database.ServerValue) {\n    return\n  }\n  const ref = firebase.database().ref()\n  const { config: { presence, sessions }, authUid } = firebase._\n  const amOnline = ref.child('.info/connected')\n  const onlineRef = ref\n    .child(\n      isFunction(presence)\n        ? presence(firebase.auth().currentUser, firebase)\n        : presence\n    )\n    .child(authUid)\n  let sessionsRef = isFunction(sessions)\n    ? sessions(firebase.auth().currentUser, firebase)\n    : sessions\n  if (sessionsRef) {\n    sessionsRef = ref.child(sessions)\n  }\n  amOnline.on('value', snapShot => {\n    if (!snapShot.val()) return\n    // user is online\n    if (sessionsRef) {\n      // add session and set disconnect\n      dispatch({ type: actionTypes.SESSION_START, payload: authUid })\n      // add new session to sessions collection\n      const session = sessionsRef.push({\n        startedAt: firebase.database.ServerValue.TIMESTAMP,\n        user: authUid\n      })\n      // Support versions of react-native-firebase that do not have setPriority\n      // on firebase.database.ThenableReference\n      if (isFunction(session.setPriority)) {\n        // set authUid as priority for easy sorting\n        session.setPriority(authUid)\n      }\n      session\n        .child('endedAt')\n        .onDisconnect()\n        .set(firebase.database.ServerValue.TIMESTAMP, () => {\n          dispatch({ type: actionTypes.SESSION_END })\n        })\n    }\n    // add correct session id to user\n    // remove from presence list\n    onlineRef.set(true)\n    onlineRef.onDisconnect().remove()\n  })\n}\n"],"file":"auth.js"}