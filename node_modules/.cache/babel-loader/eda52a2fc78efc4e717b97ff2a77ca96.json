{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: !0\n}), exports.default = createFirebaseInstance;\n\nvar _merge2 = _interopRequireDefault(require(\"lodash/fp/merge\")),\n    _isObject2 = _interopRequireDefault(require(\"lodash/isObject\")),\n    _utils = require(\"./utils\"),\n    _actions = require(\"./utils/actions\"),\n    _actions2 = require(\"./actions\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null == arguments[i] ? {} : arguments[i],\n        ownKeys = Object.keys(source);\n    \"function\" == typeof Object.getOwnPropertySymbols && (ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n    }))), ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  return key in obj ? Object.defineProperty(obj, key, {\n    value: value,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : obj[key] = value, obj;\n}\n\nfunction createFirebaseInstance(firebase, configs, dispatch) {\n  configs.enableLogging && firebase.database && \"function\" == typeof firebase.database.enableLogging && firebase.database.enableLogging(configs.enableLogging);\n  firebase._ = (0, _merge2.default)({\n    watchers: {},\n    listeners: {},\n    callbacks: {},\n    queries: {},\n    config: configs,\n    authUid: null\n  }, firebase._);\n\n  var withMeta = function withMeta(method, path, value, onComplete) {\n    if ((0, _isObject2.default)(value)) {\n      var prefix = \"update\" === method ? \"updated\" : \"created\",\n          dataWithMeta = _objectSpread({}, value, _defineProperty({}, \"\".concat(prefix, \"At\"), firebase.database.ServerValue.TIMESTAMP));\n\n      return firebase.auth().currentUser && (dataWithMeta[\"\".concat(prefix, \"By\")] = firebase.auth().currentUser.uid), firebase.database().ref(path)[method](dataWithMeta, onComplete);\n    }\n\n    return firebase.database().ref(path)[method](value, onComplete);\n  },\n      actionCreators = (0, _actions.mapWithFirebaseAndDispatch)(firebase, dispatch, {\n    signInWithPhoneNumber: _actions2.authActions.signInWithPhoneNumber\n  }, {\n    initializeAuth: _actions2.authActions.init\n  });\n\n  return Object.assign(firebase, _objectSpread({\n    ref: function ref(path) {\n      return firebase.database().ref(path);\n    },\n    set: function set(path, value, onComplete) {\n      return firebase.database().ref(path).set(value, onComplete);\n    },\n    setWithMeta: function setWithMeta(path, value, onComplete) {\n      return withMeta(\"set\", path, value, onComplete);\n    },\n    uniqueSet: function uniqueSet(path, value, onComplete) {\n      return firebase.database().ref(path).transaction(function (d) {\n        return null === d ? value : void 0;\n      }).then(function (_ref) {\n        var committed = _ref.committed,\n            snapshot = _ref.snapshot;\n\n        if (!committed) {\n          var newError = new Error(\"Path already exists.\");\n          return onComplete && onComplete(newError), Promise.reject(newError);\n        }\n\n        return onComplete && onComplete(snapshot), snapshot;\n      });\n    },\n    push: function push(path, value, onComplete) {\n      return firebase.database().ref(path).push(value, onComplete);\n    },\n    pushWithMeta: function pushWithMeta(path, value, onComplete) {\n      return withMeta(\"push\", path, value, onComplete);\n    },\n    remove: function remove(path, onComplete, options) {\n      return _actions2.queryActions.remove(firebase, dispatch, path, options).then(function () {\n        return \"function\" == typeof onComplete && onComplete(), path;\n      });\n    },\n    update: function update(path, value, onComplete) {\n      return firebase.database().ref(path).update(value, onComplete);\n    },\n    updateWithMeta: function updateWithMeta(path, value, onComplete) {\n      return withMeta(\"update\", path, value, onComplete);\n    },\n    login: function login(credentials) {\n      return _actions2.authActions.login(dispatch, firebase, credentials);\n    },\n    handleRedirectResult: function handleRedirectResult(authData) {\n      return _actions2.authActions.handleRedirectResult(dispatch, firebase, authData);\n    },\n    logout: function logout() {\n      return _actions2.authActions.logout(dispatch, firebase);\n    },\n    updateAuth: function updateAuth(authUpdate, updateInProfile) {\n      return _actions2.authActions.updateAuth(dispatch, firebase, authUpdate, updateInProfile);\n    },\n    updateEmail: function updateEmail(newEmail, updateInProfile) {\n      return _actions2.authActions.updateEmail(dispatch, firebase, newEmail, updateInProfile);\n    },\n    updateProfile: function updateProfile(profileUpdate, options) {\n      return _actions2.authActions.updateProfile(dispatch, firebase, profileUpdate, options);\n    },\n    uploadFile: function uploadFile(path, file, dbPath, options) {\n      return _actions2.storageActions.uploadFile(dispatch, firebase, {\n        path: path,\n        file: file,\n        dbPath: dbPath,\n        options: options\n      });\n    },\n    uploadFiles: function uploadFiles(path, files, dbPath, options) {\n      return _actions2.storageActions.uploadFiles(dispatch, firebase, {\n        path: path,\n        files: files,\n        dbPath: dbPath,\n        options: options\n      });\n    },\n    deleteFile: function deleteFile(path, dbPath) {\n      return _actions2.storageActions.deleteFile(dispatch, firebase, {\n        path: path,\n        dbPath: dbPath\n      });\n    },\n    createUser: function createUser(credentials, profile) {\n      return _actions2.authActions.createUser(dispatch, firebase, credentials, profile);\n    },\n    resetPassword: function resetPassword(credentials) {\n      return _actions2.authActions.resetPassword(dispatch, firebase, credentials);\n    },\n    confirmPasswordReset: function confirmPasswordReset(code, password) {\n      return _actions2.authActions.confirmPasswordReset(dispatch, firebase, code, password);\n    },\n    verifyPasswordResetCode: function verifyPasswordResetCode(code) {\n      return _actions2.authActions.verifyPasswordResetCode(dispatch, firebase, code);\n    },\n    watchEvent: function watchEvent(type, path, storeAs) {\n      var options = 3 < arguments.length && arguments[3] !== void 0 ? arguments[3] : {};\n      return _actions2.queryActions.watchEvent(firebase, dispatch, _objectSpread({\n        type: type,\n        path: path,\n        storeAs: storeAs\n      }, options));\n    },\n    unWatchEvent: function unWatchEvent(type, path, queryId) {\n      var options = 3 < arguments.length && arguments[3] !== void 0 ? arguments[3] : {};\n      return _actions2.queryActions.unWatchEvent(firebase, dispatch, _objectSpread({\n        type: type,\n        path: path,\n        queryId: queryId\n      }, options));\n    },\n    reloadAuth: function reloadAuth() {\n      return _actions2.authActions.reloadAuth(dispatch, firebase);\n    },\n    linkWithCredential: function linkWithCredential(credential) {\n      return _actions2.authActions.linkWithCredential(dispatch, firebase, credential);\n    },\n    promiseEvents: function promiseEvents(watchArray, options) {\n      var inputAsFunc = (0, _utils.createCallable)(watchArray),\n          prevData = inputAsFunc(options, firebase),\n          queryConfigs = (0, _utils.getEventsFromInput)(prevData);\n      return Promise.all(queryConfigs.map(function (queryConfig) {\n        return _actions2.queryActions.watchEvent(firebase, dispatch, queryConfig);\n      }));\n    },\n    dispatch: dispatch\n  }, actionCreators));\n}\n\nmodule.exports = exports.default;","map":null,"metadata":{},"sourceType":"script"}