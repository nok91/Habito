{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mohammednokri/Desktop/Projects/React Projects/Habito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mohammednokri/Desktop/Projects/React Projects/Habito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/mohammednokri/Desktop/Projects/React Projects/Habito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/mohammednokri/Desktop/Projects/React Projects/Habito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/Users/mohammednokri/Desktop/Projects/React Projects/Habito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useState, useEffect } from 'react';\nimport { firestore } from 'firebase/app';\n\nvar secondsToDate = function secondsToDate(seconds) {\n  return new Date(seconds * 1000);\n};\n\nvar mapDates = function mapDates(doc) {\n  var entries = Object.entries(doc);\n  var newDoc = entries.reduce(function (finalDoc, _ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        value = _ref2[1];\n\n    return _objectSpread({}, finalDoc, _defineProperty({}, key, value && value.hasOwnProperty('seconds') ? secondsToDate(value.seconds) : value));\n  }, {});\n  return newDoc;\n};\n\nvar getDataFromReference =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(record) {\n    var result;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return record.get();\n\n          case 2:\n            result = _context.sent;\n            return _context.abrupt(\"return\", result.data());\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getDataFromReference(_x) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nvar mapReferences =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(doc) {\n    var newDoc, results;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            newDoc = _objectSpread({}, doc);\n            _context3.next = 3;\n            return Promise.all(Object.entries(newDoc).map(\n            /*#__PURE__*/\n            function () {\n              var _ref6 = _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee2(_ref5) {\n                var _ref7, key, value;\n\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _ref7 = _slicedToArray(_ref5, 2), key = _ref7[0], value = _ref7[1];\n\n                        if (!(value && value instanceof firestore.DocumentReference)) {\n                          _context2.next = 7;\n                          break;\n                        }\n\n                        _context2.t0 = key;\n                        _context2.next = 5;\n                        return getDataFromReference(value);\n\n                      case 5:\n                        _context2.t1 = _context2.sent;\n                        return _context2.abrupt(\"return\", [_context2.t0, _context2.t1]);\n\n                      case 7:\n                        _context2.t2 = key;\n                        _context2.next = 10;\n                        return Promise.resolve(value);\n\n                      case 10:\n                        _context2.t3 = _context2.sent;\n                        return _context2.abrupt(\"return\", [_context2.t2, _context2.t3]);\n\n                      case 12:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2);\n              }));\n\n              return function (_x3) {\n                return _ref6.apply(this, arguments);\n              };\n            }()));\n\n          case 3:\n            results = _context3.sent;\n            results.forEach(function (_ref8) {\n              var _ref9 = _slicedToArray(_ref8, 2),\n                  key = _ref9[0],\n                  value = _ref9[1];\n\n              return newDoc[key] = value;\n            });\n            return _context3.abrupt(\"return\", newDoc);\n\n          case 6:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function mapReferences(_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport default (function (collectionName) {\n  var documentId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var searchObj = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var useRefs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isErrored = _useState4[0],\n      setIsErrored = _useState4[1];\n\n  var _useState5 = useState(documentId ? null : []),\n      _useState6 = _slicedToArray(_useState5, 2),\n      results = _useState6[0],\n      setResults = _useState6[1];\n\n  var getData =\n  /*#__PURE__*/\n  function () {\n    var _ref10 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      var collection, query, doc, data, docsWithDates, mappedDoc, reference, docs, docsWithReferences;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              setIsLoading(true);\n              _context4.prev = 1;\n              collection = firestore().collection(collectionName);\n\n              if (!documentId) {\n                _context4.next = 26;\n                break;\n              }\n\n              _context4.next = 6;\n              return collection.doc(documentId).get();\n\n            case 6:\n              doc = _context4.sent;\n              _context4.next = 9;\n              return doc.data();\n\n            case 9:\n              data = _context4.sent;\n\n              if (data) {\n                _context4.next = 14;\n                break;\n              }\n\n              setIsLoading(false);\n              setResults(null);\n              return _context4.abrupt(\"return\");\n\n            case 14:\n              docsWithDates = mapDates(_objectSpread({}, data, {\n                id: documentId\n              }));\n\n              if (!useRefs) {\n                _context4.next = 21;\n                break;\n              }\n\n              _context4.next = 18;\n              return mapReferences(docsWithDates);\n\n            case 18:\n              _context4.t0 = _context4.sent;\n              _context4.next = 22;\n              break;\n\n            case 21:\n              _context4.t0 = docsWithDates;\n\n            case 22:\n              mappedDoc = _context4.t0;\n              setIsLoading(false);\n              setResults(mappedDoc);\n              return _context4.abrupt(\"return\");\n\n            case 26:\n              if (!searchObj) {\n                _context4.next = 39;\n                break;\n              }\n\n              if (!searchObj.reference) {\n                _context4.next = 34;\n                break;\n              }\n\n              reference = firestore().collection(searchObj.reference.collection).doc(searchObj.reference.id);\n              _context4.next = 31;\n              return collection.where(searchObj.field, searchObj.operator, reference).get();\n\n            case 31:\n              query = _context4.sent;\n              _context4.next = 37;\n              break;\n\n            case 34:\n              _context4.next = 36;\n              return collection.where(searchObj.field, searchObj.operator, searchObj.value).get();\n\n            case 36:\n              query = _context4.sent;\n\n            case 37:\n              _context4.next = 42;\n              break;\n\n            case 39:\n              _context4.next = 41;\n              return collection.get();\n\n            case 41:\n              query = _context4.sent;\n\n            case 42:\n              setIsLoading(false);\n              docs = query.docs.map(function (doc) {\n                return _objectSpread({}, doc.data(), {\n                  id: doc.id\n                });\n              }).map(mapDates);\n\n              if (!useRefs) {\n                _context4.next = 50;\n                break;\n              }\n\n              _context4.next = 47;\n              return Promise.all(docs.map(mapReferences));\n\n            case 47:\n              _context4.t1 = _context4.sent;\n              _context4.next = 51;\n              break;\n\n            case 50:\n              _context4.t1 = docs;\n\n            case 51:\n              docsWithReferences = _context4.t1;\n              setResults(docsWithReferences);\n              _context4.next = 60;\n              break;\n\n            case 55:\n              _context4.prev = 55;\n              _context4.t2 = _context4[\"catch\"](1);\n              setIsErrored(true);\n              setIsLoading(false);\n              console.error(_context4.t2);\n\n            case 60:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[1, 55]]);\n    }));\n\n    return function getData() {\n      return _ref10.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getData();\n  }, []);\n  return [isLoading, isErrored, results];\n});","map":{"version":3,"sources":["/Users/mohammednokri/Desktop/Projects/React Projects/Habito/src/hooks/useViewDocument.js"],"names":["useState","useEffect","firestore","secondsToDate","seconds","Date","mapDates","doc","entries","Object","newDoc","reduce","finalDoc","key","value","hasOwnProperty","getDataFromReference","record","get","result","data","mapReferences","Promise","all","map","DocumentReference","resolve","results","forEach","collectionName","documentId","searchObj","useRefs","isLoading","setIsLoading","isErrored","setIsErrored","setResults","getData","collection","docsWithDates","id","mappedDoc","reference","where","field","operator","query","docs","docsWithReferences","console","error"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { firestore } from 'firebase/app'\n\nconst secondsToDate = seconds => new Date(seconds * 1000)\n\nconst mapDates = doc => {\n  const entries = Object.entries(doc)\n\n  const newDoc = entries.reduce((finalDoc, [key, value]) => {\n    return {\n      ...finalDoc,\n      [key]:\n        value && value.hasOwnProperty('seconds')\n          ? secondsToDate(value.seconds)\n          : value\n    }\n  }, {})\n\n  return newDoc\n}\n\nconst getDataFromReference = async record => {\n  const result = await record.get()\n  return result.data()\n}\n\nconst mapReferences = async doc => {\n  const newDoc = { ...doc }\n\n  const results = await Promise.all(\n    Object.entries(newDoc).map(async ([key, value]) => {\n      if (value && value instanceof firestore.DocumentReference) {\n        return [key, await getDataFromReference(value)]\n      }\n      return [key, await Promise.resolve(value)]\n    })\n  )\n\n  results.forEach(([key, value]) => (newDoc[key] = value))\n\n  return newDoc\n}\n\nexport default (\n  collectionName,\n  documentId = null,\n  searchObj = null,\n  useRefs = true\n) => {\n  const [isLoading, setIsLoading] = useState(false)\n  const [isErrored, setIsErrored] = useState(false)\n  const [results, setResults] = useState(documentId ? null : [])\n\n  const getData = async () => {\n    setIsLoading(true)\n\n    try {\n      const collection = firestore().collection(collectionName)\n\n      let query\n\n      if (documentId) {\n        const doc = await collection.doc(documentId).get()\n        const data = await doc.data()\n\n        if (!data) {\n          setIsLoading(false)\n          setResults(null)\n          return\n        }\n\n        const docsWithDates = mapDates({\n          ...data,\n          id: documentId\n        })\n\n        const mappedDoc = useRefs\n          ? await mapReferences(docsWithDates)\n          : docsWithDates\n\n        setIsLoading(false)\n        setResults(mappedDoc)\n        return\n      }\n\n      if (searchObj) {\n        if (searchObj.reference) {\n          const reference = firestore()\n            .collection(searchObj.reference.collection)\n            .doc(searchObj.reference.id)\n\n          query = await collection\n            .where(searchObj.field, searchObj.operator, reference)\n            .get()\n        } else {\n          query = await collection\n            .where(searchObj.field, searchObj.operator, searchObj.value)\n            .get()\n        }\n      } else {\n        query = await collection.get()\n      }\n\n      setIsLoading(false)\n\n      const docs = query.docs\n        .map(doc => ({ ...doc.data(), id: doc.id }))\n        .map(mapDates)\n      const docsWithReferences = useRefs\n        ? await Promise.all(docs.map(mapReferences))\n        : docs\n\n      setResults(docsWithReferences)\n    } catch (err) {\n      setIsErrored(true)\n      setIsLoading(false)\n      console.error(err)\n    }\n  }\n\n  useEffect(() => {\n    getData()\n  }, [])\n\n  return [isLoading, isErrored, results]\n}\n"]},"metadata":{},"sourceType":"module"}