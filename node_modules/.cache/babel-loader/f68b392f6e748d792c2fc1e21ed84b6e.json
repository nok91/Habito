{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar flatten = require(\"array-flatten\");\n\nvar is_promise_1 = require(\"./is-promise\");\n\nfunction registerEvents(events, target, extensions, prevState, action, nextState) {\n  if (extensions === void 0) {\n    extensions = {};\n  }\n\n  if (prevState === void 0) {\n    prevState = {};\n  }\n\n  if (action === void 0) {\n    action = {};\n  }\n\n  if (nextState === void 0) {\n    nextState = {};\n  }\n\n  var logger = extensions.logger,\n      offlineStorage = extensions.offlineStorage;\n\n  var ifLoggerLog = function ifLoggerLog(eventsToLog, actionToLog, stateToLog) {\n    var rest = [];\n\n    for (var _i = 3; _i < arguments.length; _i++) {\n      rest[_i - 3] = arguments[_i];\n    }\n\n    if (typeof logger === 'function') {\n      logger.apply(void 0, [eventsToLog, actionToLog, stateToLog].concat(rest));\n    }\n  };\n\n  var isEmptyArray = function isEmptyArray(arr) {\n    return Array.isArray(arr) && arr.length === 0;\n  };\n\n  var passEventsToTarget = function passEventsToTarget(e) {\n    if (!isEmptyArray(e)) {\n      target(e);\n    }\n  };\n\n  var handleEvents = function handleEvents(e) {\n    if (offlineStorage === undefined) {\n      passEventsToTarget(e);\n      ifLoggerLog(e, action, prevState);\n    } else if (offlineStorage.isConnected(nextState)) {\n      passEventsToTarget(e);\n      ifLoggerLog(e, action, prevState);\n      offlineStorage.purgeEvents(function (oldEvents) {\n        if (!isEmptyArray(oldEvents)) {\n          target(oldEvents);\n          ifLoggerLog(oldEvents, null, null, false, true);\n        }\n      });\n    } else {\n      offlineStorage.saveEvents(e);\n      ifLoggerLog(e, action, prevState, true, false);\n    }\n  };\n\n  var asyncEvents = events.filter(is_promise_1.default);\n  var syncEvents = events.filter(function (event) {\n    return !is_promise_1.default(event);\n  });\n  handleEvents(syncEvents);\n  return Promise.all(asyncEvents).then(flatten).then(handleEvents);\n}\n\nexports.default = registerEvents;","map":null,"metadata":{},"sourceType":"script"}